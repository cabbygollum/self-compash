(window.webpackJsonp=window.webpackJsonp||[]).push([[102],{1336:function(e,t,r){"use strict";const{registerEpics:a,registerReducer:c}=r(4),n=r(2346),{trackerSetupEpic:i,trackerLoadDataEpic:o,trackerLoadTrackingEpic:s,trackerTrackEpic:l,trackerTrackDevEpic:p}=r(2347);c("tracker",n),a(i,o,s,l,p)},2346:function(e,t,r){"use strict";const a=r(10),{FETCH_COURSE_DATA:c}=r(9),{SET_TRACKER_AUTH:n}=r(483),i={_isEnabled:!1,_auth:{}};e.exports=(e=i,t)=>t.type===c&&t.payload.config._tracker&&t.payload.config._tracker._isEnabled?a({},e,{_isEnabled:!0}):e._isEnabled?t.type===n?a({},e,t.payload):e:i},2347:function(e,t,r){"use strict";(function(e){var a=r(5);const c=r(8),n=r(0),{ajax:i}=r(183),o=r(4),s=r(2),{addElement:l}=r(42),{adjustNavigationHeight:p}=r(327),{COMPONENT_COMPLETED:u,COMPONENT_TRACKABLE_CHANGE:_}=r(63),{TRACKABLE_CHANGE:d}=r(95),{WINDOW_UNLOAD:g}=r(123),{DATA_READY:b,APP_STARTED:k,setAppReadyState:f,setLearner:v}=r(9),{trackerLoadData:E,trackerSaveSession:m,setTrackerAuth:O,saveTrackingDone:T,TRACKER_LOAD_DATA:y,TRACKER_SAVE_SESSION:w,SET_TRACKER_AUTH:S}=r(483),{setTracking:A,getTracking:C,getTrackingImmediately:h}=r(486);var D=null;t.trackerSetupEpic=(e,t)=>e.filter(e=>{if(e.type!==b)return!1;const{app:r,config:a}=t.getState(),c=a._tracker;return!r.isLivePreview&&c&&c._isEnabled}).take(1).mergeMap(()=>a.Observable.of(f("tracker",!1),E())).catch(e=>(console.warn("Tracker extension error: ",e),f("tracker",!0))),t.trackerLoadDataEpic=(t,r)=>t.ofType(y).mergeMap(t=>{const{config:u}=r.getState(),_=u._tracker;switch(_._platform){case"exceed":return function(e,t){const{inline:r}=t.getState();var n=function(e,t){if(t){return c(window,"evolve.courseId")}e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var r=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null===r?"":decodeURIComponent(r[1].replace(/\+/g," "))}("_courseId",r.isEnabled);n||window.location.replace("/404");return a.Observable.forkJoin(i.getJSON(`${e._auth}?course_id=${n}`),i.getJSON("/monitor/heartbeat")).mergeMap(([e,t])=>{if(e.authenticated){const r=1e3*t,c=(new Date).getTime();window.TIME_DIFFERENCE=c-r;const{user_id:n,first_name:i,last_name:o}=e;return a.Observable.of(v({_id:n,firstName:i,lastName:o,userData:e}),O(e))}return a.Observable.of(O({authenticated:!1}))}).catch(e=>{console.log("error",e)})}(_,r);default:return function(t,r){return a.Observable.bindCallback(e.getScript)("../../bloom/bloomAPI.js").mergeMap(()=>{if(window.BLOOM_API)return a.Observable.bindCallback(window.BLOOM_API.init)({store:r,actions:{addElement:l,adjustNavigationHeight:p,trackerSaveSession:m},libraries:{React:n,Observable:a.Observable,createReactClass:s},player:o})}).mergeMap(()=>i.getJSON(t._auth)).mergeMap(e=>a.Observable.of(O(e))).catch(e=>{console.log("error",e)})}(_,r)}}),t.trackerTrackEpic=(e,t)=>e.filter(e=>{const{app:r,config:a}=t.getState();if(e.type===u||e.type===_||e.type===k||e.type===g||e.type===w||e.type===d){const e=a._tracker;return!r.isLivePreview&&e&&e._isEnabled}return!1}).mergeMap(e=>{if(e.type===g||e.type===w){var t=h();return a.Observable.of(t)}return a.Observable.bindCallback(C)()}).mergeMap(e=>function(e,t){const{app:r,config:n,tracker:o}=t.getState();switch(n._tracker._platform){case"exceed":return function(e,t,r){if(r){var c=`${t._pushData}/${D}`;return i.put(c,e,{"Content-Type":"application/json"}).catch(e=>{window.location.reload()})}return a.Observable.empty()}(e,n._tracker,o.authenticated);default:return function(e,t){var r=e._user,a=e._course,n=`${t._pushData}/${r}/${a}`;return i.put(n,e,{"Content-Type":"application/json"}).catch(e=>{c(e,"response._isLoginRequired",!1)&&window.location.reload()})}(e,n._tracker)}}(e,t)).mergeMap(()=>a.Observable.of(T())),t.trackerTrackDevEpic=(e,t)=>e.filter(e=>{const{app:r,tracking:a}=t.getState();return(e.type===u||e.type===_||e.type===k||e.type===g||e.type===w||e.type===d)&&(r.isLivePreview&&a._isTrackingDevLogEnabled)}).mergeMap(e=>(console.log("TRACKER - action type:"+e.type,h()),a.Observable.empty())),t.trackerLoadTrackingEpic=(t,r)=>t.ofType(S).mergeMap(()=>{const{config:t}=r.getState();switch(t._tracker._platform){case"exceed":return function(t){const{config:r,tracker:c}=t.getState();if(c.authenticated&&c.enrollment_course_activity_id&&c.user_id){var u=`/evolve/api/v1/enrollment_course_activities/${D=c.enrollment_course_activity_id}/decorator.js`;return a.Observable.bindCallback(e.getScript)(u).mergeMap(()=>{if(window.EXCEED_API)return a.Observable.bindCallback(window.EXCEED_API.init)({store:t,actions:{addElement:l,adjustNavigationHeight:p,trackerSaveSession:m},libraries:{React:n,Observable:a.Observable,createReactClass:s},player:o})}).mergeMap(()=>{var e=`${r._tracker._getData}/${D}`;return i.getJSON(e)}).mergeMap(e=>(A(e,!0),a.Observable.of(f("tracker",!0))))}return a.Observable.of(f("tracker",!0))}(r);default:return function(e){const{config:t,tracker:r}=e.getState();var c=t._courseId,n=`${t._tracker._getData}/${r._user._id}/${c}`;return i.getJSON(n).mergeMap(e=>{A(e,!0);const{_id:t,firstName:c,lastName:n}=r._user;return a.Observable.of(f("tracker",!0),v({_id:t,firstName:c,lastName:n}))})}(r)}})}).call(this,r(27))}}]);